<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARPOL Waste Management System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
            color: white;
            min-height: 100vh;
        }
        
        #root {
            min-height: 100vh;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 1.5rem;
            flex-direction: column;
            gap: 1rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #3B82F6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            <div>Loading MARPOL Application...</div>
        </div>
    </div>

    <script src="/app/component-bridge.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Component loader - dynamically loads your existing components
        const ComponentLoader = ({ componentPath, fallback: FallbackComponent }) => {
            const [Component, setComponent] = useState(null);
            const [error, setError] = useState(null);
            
            useEffect(() => {
                const loadComponent = async () => {
                    try {
                        console.log('Loading component:', componentPath);
                        
                        // Map component paths to your actual files
                        const componentMap = {
                            'Header': '/app/components/layout/Header.js',
                            'Dashboard': '/app/pages/dashboard/Dashboard.js', 
                            'MainForm': '/app/pages/forms/MainForm.js',
                            'Reports': '/app/pages/reports/Reports.js',
                            'Logo3D': '/app/components/layout/Logo3D.jsx'
                        };
                        
                        // For now, use simple components. We'll enhance this to load actual files
                        // Use the component bridge to load your actual components
                        if (window.MARPOL_COMPONENTS && window.MARPOL_COMPONENTS[componentPath]) {
                            setComponent(() => window.MARPOL_COMPONENTS[componentPath]);
                        } else {
                            throw new Error(`Component ${componentPath} not found in bridge`);
                        }
                        
                        if (simpleComponents[componentPath]) {
                            setComponent(() => simpleComponents[componentPath]);
                        } else {
                            throw new Error(`Component ${componentPath} not found`);
                        }
                        
                    } catch (err) {
                        console.error('Failed to load component:', err);
                        setError(err);
                    }
                };
                
                loadComponent();
            }, [componentPath]);
            
            if (error) {
                return FallbackComponent ? React.createElement(FallbackComponent) 
                    : React.createElement('div', { style: { color: 'red' } }, `Error loading ${componentPath}`);
            }
            
            if (!Component) {
                return FallbackComponent ? React.createElement(FallbackComponent)
                    : React.createElement('div', null, `Loading ${componentPath}...`);
            }
            
            return React.createElement(Component);
        };
        
        // Main App Component - uses your existing component structure
        function App() {
            const [currentPage, setCurrentPage] = useState('dashboard');
            
            useEffect(() => {
                const handleNavigate = (event) => {
                    setCurrentPage(event.detail);
                };
                
                window.addEventListener('navigate', handleNavigate);
                return () => window.removeEventListener('navigate', handleNavigate);
            }, []);
            
            const renderPage = () => {
                switch (currentPage) {
                    case 'dashboard': 
                        return React.createElement(ComponentLoader, { 
                            componentPath: 'Dashboard',
                            fallback: () => React.createElement('div', null, 'Loading Dashboard...')
                        });
                    case 'forms':
                        return React.createElement(ComponentLoader, {
                            componentPath: 'MainForm', 
                            fallback: () => React.createElement('div', null, 'Loading Forms...')
                        });
                    case 'reports':
                        return React.createElement(ComponentLoader, {
                            componentPath: 'Reports',
                            fallback: () => React.createElement('div', null, 'Loading Reports...')
                        });
                    default:
                        return React.createElement(ComponentLoader, {
                            componentPath: 'Dashboard',
                            fallback: () => React.createElement('div', null, 'Loading...')
                        });
                }
            };
            
            return React.createElement('div', null,
                React.createElement(ComponentLoader, {
                    componentPath: 'Header',
                    fallback: () => React.createElement('div', null, 'Loading Header...')
                }),
                renderPage()
            );
        }
        
        // Render the app
        console.log('Rendering MARPOL Application...');
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
